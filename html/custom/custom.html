<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>自定行程</title>
    <link href="./custom.css" rel="stylesheet" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    />
    <link href="../navbar.css" rel="stylesheet" />
    <link href="../footer.css" rel="stylesheet" />
    <link rel="icon" href="./icon/title_icon.ico" type="image/x-icon" />
    <link
      rel="stylesheet"
      href="https://npmcdn.com/leaflet@0.7.7/dist/leaflet.css"
    />
    <script src="https://npmcdn.com/leaflet@0.7.7/dist/leaflet.js"></script>
  </head>
  <body>
    <nav class="navbar">
      <div class="light"></div>
      <aside class="aside">
        <img class="x" src="../x.svg" />
        <div class="background"></div>
        <ul>
          <li class="a1">
            <div class="theme_block">
              主題景點
              <ul class="theme">
                <li>
                  <a href="../mountain/mountain.html"><span>幽遊山徑</span></a>
                </li>
                <li>
                  <a href="../mountain/mountain.html"><span>無敵海景</span></a>
                </li>
                <li>
                  <a href="../mountain/mountain.html"><span>打卡熱點</span></a>
                </li>
                <li>
                  <a href="../mountain/mountain.html"><span>知性之旅</span></a>
                </li>
              </ul>
            </div>
          </li>
          <li class="a1">
            <div class="food_block">
              小吃攻略
              <ul class="food">
                <li>
                  <a href="../night_market/night_market.html"
                    ><span>廟口特輯</span></a
                  >
                </li>
                <li>
                  <a href="../night_market/night_market.html"
                    ><span class="xxx">咖啡之旅</span></a
                  >
                </li>
              </ul>
            </div>
          </li>
          <li class="a1">
            <div class="travel_block">
              <span class="background">行程安排</span>
              <ul class="travel">
                <li>
                  <a href="../recommend/recommend.html"
                    ><span>推薦行程</span></a
                  >
                </li>
                <li>
                  <a href="../custom/custom.html"><span>自訂行程</span></a>
                </li>
              </ul>
            </div>
          </li>
          <li class="a1">
            <a href="../store/store.html">選物小店</a>
          </li>
          <li class="a1">
            <a href="../master/master.html">達人分享</a>
          </li>
          <li class="a1">
            <a href="#">會員專區</a>
          </li>
        </ul>
      </aside>
      <a href="../index/index.html"
        ><img class="logo" src="../../use_photo/navbar/kwlogo.png "
      /></a>
      <a href="../index/index.html"
        ><img class="logo2" src="../../use_photo/navbar/fron_logo.png"
      /></a>
      <div class="img">
        <img class="menu" src="../../use_photo/navbar/bg.png" />
      </div>
    </nav>
    <div class="banner">
      <p>開始一場旅行吧!</p>
    </div>
    <div class="bread">
      <div class="center">
        <a href="../index/index.html">首頁</a> / <a href="#" a>行程安排</a> /
        <span>推薦行程</span>
      </div>
    </div>
    <main class="main">
      <p class="sol animate__animated animate__fadeInDown">
        將景點圖片拖移至框框內，開始規劃今天的行程吧!
      </p>
      <p id="phone" class="sol animate__animated animate__fadeInDown">
        依照想去的順序點選景點圖片，開始規劃今天的行程吧!
      </p>
      <article class="images">
        <div class="grid">
          <div class="grid_item">
            <div class="content">
              <img class="point_1" src="./images/01.png" />
              <p>老鷹岩</p>
            </div>
          </div>
          <div class="grid_item">
            <div class="content">
              <img class="point_2" src="./images/02.png" />
              <p>八斗子站</p>
            </div>
          </div>
          <div class="grid_item">
            <div class="content">
              <img class="point_3" src="./images/03.png" />
              <p>鐵道自行車</p>
            </div>
          </div>
          <div class="grid_item">
            <div class="content">
              <img class="point_4" src="./images/04.png" />
              <p>望幽谷</p>
            </div>
          </div>
          <div class="grid_item">
            <div class="content">
              <img class="point_5" src="./images/05.png" />
              <p>潮境公園</p>
            </div>
          </div>
          <div class="grid_item">
            <div class="content">
              <img class="point_6" src="./images/06.png" />
              <p>火號山</p>
            </div>
          </div>
          <div class="grid_item">
            <div class="content">
              <img class="point_7" src="./images/07.png" />
              <p>正濱漁港</p>
            </div>
          </div>
          <div class="grid_item">
            <div class="content">
              <img class="point_8" src="./images/08.png" />
              <p>海科館</p>
            </div>
          </div>
          <div class="grid_item">
            <div class="content">
              <img class="point_9" src="./images/09.png" />
              <p>佛手洞</p>
            </div>
          </div>
          <div class="grid_item">
            <div class="content">
              <img class="point_10" src="./images/10.png" />
              <p>槓子寮山</p>
            </div>
          </div>
          <div class="grid_item">
            <div class="content">
              <img class="point_11" src="./images/11.png" />
              <p>外木山步道</p>
            </div>
          </div>
          <div class="grid_item">
            <div class="content">
              <img class="point_12" src="./images/12.png" />
              <p>基隆燈塔</p>
            </div>
          </div>
        </div>
      </article>
      <article class="goto">
        <img class="vector" src="./icon/Vector 3.png" />
        <div class="stop_1">
          <p>停靠站1<button class="res">重選</button></p>

          <img class="plus" src="./icon/plus.png" />
        </div>
        <div class="stop_2">
          <p>停靠站2<button class="res">重選</button></p>
          <img class="plus" src="./icon/plus.png" />
        </div>
        <div class="stop_3">
          <p>停靠站3<button class="res">重選</button></p>
        </div>
      </article>
      <article class="next">
        <div class="background">
          <p class="time">路程規劃時間</p>
          <div id="map">
            this
            <!-- <iframe
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d28895.236207871327!2d121.73333815953364!3d25.13891846670842!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x345d4e4456aeee69%3A0xe0644dd52b7522f3!2z5Z-66ZqG5YWn5riv!5e0!3m2!1szh-TW!2stw!4v1634827639547!5m2!1szh-TW!2stw"
              width="475"
              height="390"
              style="border: 0"
              allowfullscreen=""
              loading="lazy"
            ></iframe> -->
          </div>
          <div class="suggest">
            <p class="title">建議您規劃:<span> 3小時</span></p>
            <p>享受一場放鬆的充電之旅吧!</p>
            <button type="submit">儲存本次行程</button>
          </div>
        </div>
      </article>
    </main>
    <div class="footer">
      <div class="index">
        <a href="#">常見問題</a>
        <a href="#">交通資訊</a>
        <a href="#">聯絡我們</a>
        <a href="#">隱私政策</a>
        <a href="#">服務安全宣告</a>
      </div>
      <div class="slogan">
        <p class="h1">基隆漫步 Keelung Walk</p>
        <!-- <a class="fbicon" href="#"><img src="../../use_photo/footer/fb.png"></a>
        <a class="igicon" href="#"><img src="../../use_photo/footer/ig.png"></a> -->
        <p class="local">
          連結在地生活、人物、文化、飲食、旅遊 深入更多的精彩。
        </p>
        <p class="copy">
          Copyright 2021 基隆漫步 Keelung Walk All rights reserved.
        </p>
      </div>
      <div class="tiba">
        <p>
          本網站為緯育TibaMe前端設計工程師班第72期學員專題作品
          <br />
          &#42;若有侵權疑慮，您可以私訊<a
            href="https://www.facebook.com/webindex/"
            >[TibaMe-前端設計工程師養成班]</a
          >，後續會由專人協助處理。
          <br />
          <a
            href="https://docs.google.com/document/d/1MTq7m2yDvs8SjwMVf-UZ7V_P-xti-CthnQFX-fWS7ks/edit?usp=sharing"
            >-----網站參考資源請點此-----</a
          >
        </p>
      </div>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script>
      $(function () {
        // 點擊
        $("div.img").on("click", function () {
          // -open 的樣式切換
          $("aside").toggleClass("-open"), $("div.light").toggleClass("-on");
        });
      });
      $(function () {
        // 點擊
        $("img.x").on("click", function () {
          // -open 的樣式切換
          $("aside").removeClass("-open"), $("div.light").removeClass("-on");
        });
      });
      $(window).on("click",(e) =>{
        const light = document.querySelector(".light");
        if(e.target == light){
          $("aside").removeClass("-open"), $("div.light").removeClass("-on");
        }
      })
      const map = L.map("map");
      // 設定圖資來源
      var osmUrl = "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png";
      var osm = new L.TileLayer(osmUrl, { minZoom: 8, maxZoom: 16 });
      map.addLayer(osm);
      // 設定經緯度座標（以基隆市
      map.setView(new L.LatLng(25.14038729600396, 121.75071934110419), 12);
      //地圖設定
    
      //抓出所有圖片裝上事件聆聽器
      let img = document.querySelectorAll(".content > img");
      let stop_1 = document.querySelector(".stop_1 p");
      let stop_2 = document.querySelector(".stop_2 p");
      let stop_3 = document.querySelector(".stop_3 p");

      for (let i = 0; i < img.length; i++) {
        img[i].addEventListener("dragstart", startDrag);
        img[i].addEventListener("dragend", null);
      }

      //設定可以停在裡面
      stop_1.addEventListener("dragover", (e) => e.preventDefault());
      stop_2.addEventListener("dragover", (e) => e.preventDefault());
      stop_3.addEventListener("dragover", (e) => e.preventDefault());

      //設定可以放下
      stop_1.addEventListener("drop", dropped);
      stop_2.addEventListener("drop", dropped);
      stop_3.addEventListener("drop", dropped);

      function startDrag(e) {
        let data = e.target;
        // console.log(e.target);
        // e.dataTransfer.setData('image/jpeg',data);
        e.dataTransfer.setData("shin", data.getAttribute("src")); // 自行命名
        e.dataTransfer.setData("imgClass", data.getAttribute("class")); // 自行命名
      }
      function dropped(e) {
        e.preventDefault();
        e.target.innerHTML = `<button class="res">重選</button> <img class=${e.dataTransfer.getData(
          "imgClass"
        )} src=${e.dataTransfer.getData("shin")}>`;

        //先在外部宣告
        let marker_1;
        let marker_2;
        let marker_3;
        let marker_4;
        let marker_5;
        let marker_6;
        let marker_7;
        let marker_8;
        let marker_9;
        let marker_10;
        let marker_11;
        let marker_12;
        
        //開始判斷現在丟進去的地點
        if (this.children[1].classList[0] == "point_1") {
          marker_1 = L.marker([25.162737546248735, 121.70686811366318]).addTo(map);
          map.panTo(L.latLng(25.162737546248735, 121.70686811366318));
          marker_1.bindPopup("老鷹岩");
          marker_1.openPopup();
        } else if (this.children[1].classList[0] == "point_2") {
          marker_2 = L.marker([25.13645238587383, 121.80312005974466]).addTo(map);
          map.panTo(L.latLng(25.13645238587383, 121.80312005974466));
          marker_2.bindPopup("八斗子站");
          marker_2.openPopup();
        } else if (this.children[1].classList[0] == "point_3") {
          marker_3 = L.marker([25.13488553538289, 121.80557745221616]).addTo(map);
          map.panTo(L.latLng(25.13488553538289, 121.80557745221616));
          marker_3.bindPopup("鐵道自行車");
          marker_3.openPopup();
        } else if (this.children[1].classList[0] == "point_4") {
          marker_4 = L.marker([25.14612667075538, 121.79781919836209]).addTo(map);
          map.panTo(L.latLng(25.14612667075538, 121.79781919836209));
          marker_4.bindPopup("望幽谷");
          marker_4.openPopup();
        } else if (this.children[1].classList[0] == "point_5") {
          marker_5 = L.marker([25.143956325767046, 121.80343820974633]).addTo(map);
          map.panTo(L.latLng(25.143956325767046, 121.80343820974633));
          marker_5.bindPopup("潮境公園");
          marker_5.openPopup();
        } else if (this.children[1].classList[0] == "point_6") {
          marker_6 = L.marker([25.146724553458714, 121.74328647559278]).addTo(map);
          map.panTo(L.latLng(25.146724553458714, 121.74328647559278));
          marker_6.bindPopup("火號山");
          marker_6.openPopup();
        } else if (this.children[1].classList[0] == "point_7") {
          marker_7 = L.marker([25.15293056999333, 121.76903683051896]).addTo(map);
          map.panTo(L.latLng(25.15293056999333, 121.76903683051896));
          marker_7.bindPopup("正濱漁港");
          marker_7.openPopup();
        } else if (this.children[1].classList[0] == "point_8") {
          marker_8 = L.marker([25.14055351107385, 121.79861702221025]).addTo(map);
          map.panTo(L.latLng(25.14055351107385, 121.79861702221025));
          marker_8.bindPopup("海科館");
          marker_8.openPopup();
        } else if (this.children[1].classList[0] == "point_9") {
          marker_9 = L.marker([25.146079103040943, 121.74813122163108]).addTo(map);
          map.panTo(L.latLng(25.146079103040943, 121.74813122163108));
          marker_9.bindPopup("佛手洞");
          marker_9.openPopup();
        } else if (this.children[1].classList[0] == "point_10") {
          marker_10 = L.marker([25.144915797918, 121.77566111583054]).addTo(map);
          map.panTo(L.latLng(25.144915797918, 121.77566111583054));
          marker_10.bindPopup("槓子寮山");
          marker_10.openPopup();
        } else if (this.children[1].classList[0] == "point_11") {
          marker_11 = L.marker([25.165510450018964, 121.72023593678324]).addTo(map);
          map.panTo(L.latLng(25.165510450018964, 121.72023593678324));
          marker_11.bindPopup("外木山步道");
          marker_11.openPopup();
        } else if (this.children[1].classList[0] == "point_12") {
          marker_12 = L.marker([25.156171080642697, 121.74774531371027]).addTo(map);
          map.panTo(L.latLng(25.156171080642697, 121.74774531371027));
          marker_12.bindPopup("基隆燈塔");
          marker_12.openPopup();
        }

        let markers = [marker_1, marker_2, marker_3, marker_4, marker_5, marker_6, marker_7, marker_8, marker_9, marker_10, marker_11, marker_12];
        const prange = e.target;
        e.target.children[0].addEventListener("click", function() {
          if(prange.children[1].style.display !== "none"){
            const imgNumber =  prange.children[1].classList[0].replace("point_","");//把point濾掉，回傳空字串，或是自訂名稱
            prange.children[1].style.display = "none";
            if(e.path[1].classList == "stop_1"){
              prange.insertAdjacentHTML("afterbegin", `停靠站1`) 
              map.removeLayer(markers[Number(imgNumber)-1]);//先把imgNumber轉成數字，再減1，再回markers陣列裡找出符合索引值的值。
            }else if(e.path[1].classList == "stop_2"){
              prange.insertAdjacentHTML("afterbegin", `停靠站2`) 
              map.removeLayer(markers[Number(imgNumber)-1]);
            }else if(e.path[1].classList == "stop_3"){
              prange.insertAdjacentHTML("afterbegin", `停靠站3`) 
              map.removeLayer(markers[Number(imgNumber)-1]);
            }
          }
        })
      }
    </script>
  </body>
</html>
